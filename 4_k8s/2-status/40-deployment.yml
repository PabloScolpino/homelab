---
apiVersion: apps/v1
kind: Deployment
metadata:
  namespace: status
  name: smokeping
  labels:
    app: smokeping
spec:
  replicas: 1
  selector:
    matchLabels:
      app: smokeping
  template:
    metadata:
      labels:
        app: smokeping
    spec:
      containers:
        - name: smokeping
          image: linuxserver/smokeping:2.7.3
          ports:
            - name: web
              containerPort: 80
              protocol: TCP
          env:
            - name: PUID
              value: "1003"
            - name: PGID
              value: "1006"
            - name: TZ
              value: America/Argentina/Buenos_Aires
          volumeMounts:
            - name: config
              mountPath: "/config"
            - name: data
              mountPath: "/data"
      securityContext:
        fsGroup: 1006
      volumes:
        - name: config
          persistentVolumeClaim:
            claimName: smokeping-config
        - name: data
          persistentVolumeClaim:
            claimName: smokeping-data
# ---
# apiVersion: v1
# kind: Service
# metadata:
#   namespace: status
#   name: smokeping
#   labels:
#     app: smokeping
# spec:
#   type: NodePort
#   selector:
#     app: smokeping
#   ports:
#     - name: web
#       port: 80
#       protocol: TCP
# ---
# apiVersion: traefik.containo.us/v1alpha1
# kind: IngressRoute
# metadata:
#   namespace: status
#   name: smokeping
# spec:
#   entryPoints:
#     - web
#   routes:
#     - match: Host(`status.ar.olumpos.net`)
#       kind: Rule
#       services:
#         - name: smokeping
#           port: 80
# ---
# apiVersion: traefik.containo.us/v1alpha1
# kind: IngressRoute
# metadata:
#   namespace: status
#   name: smokeping-tls
# spec:
#   entryPoints:
#     - websecure
#   routes:
#     - match: Host(`status.ar.olumpos.net`)
#       kind: Rule
#       services:
#         - name: smokeping
#           port: 80
#   tls:
#     certResolver: letsencrypt
#     domains:
#       - main: status.ar.olumpos.net
